(function($){$.fn.RSmenu=function(menu){var that=this;var offset=$(that).offset();this.top=offset.top;this.left=offset.left;if(!menu){return}if(!menu.options){menu.options={}}switch(menu.options.active){case"leftClick":$(this).on("click",function(e){e.preventDefault();e.stopPropagation();that.mouseX=e.clientX;that.mouseY=e.clientY;render()});break;default:$(this).on("contextmenu",function(e){e.preventDefault();e.stopPropagation();that.mouseX=e.clientX;that.mouseY=e.clientY;render()})}function render(){if(menu.options.onShow){menu.options.onShow()}that.$el=$('<div id="RSmenu">').appendTo("body");if(menu.options.debug){that.$el.addClass("debug")}that.$el.on("click contextmenu",function(e){e.preventDefault();that.$el.remove();if(menu.options.onClose){menu.options.onClose()}});renderPopUpMenu(menu)}function renderPopUpMenu(menu,parent){that.trigger("createMenu",parent&&parent.data("level")||0);var $menuInstance=$('<div class="menu">').appendTo(that.$el);if(parent){$menuInstance[0].dataset.level=parent.data("level")+1;$menuInstance.data("parent",parent);$menuInstance.addClass("submenu")}else{$menuInstance[0].dataset.level=0}menu.data.forEach(function(item){if(typeof item.hide==="function"){if(item.hide())return}else if(typeof item.hide==="boolean"){if(item.hide)return}if(item.divider){var $itemInstance=$('<div class="divider">').appendTo($menuInstance)}else{var $itemInstance=$('<div class="item">').html(item.text).appendTo($menuInstance);if(item.class){$itemInstance.addClass(item.class)}if(item.isTitle){$itemInstance.data("isTitle",true);$itemInstance.addClass("isTitle")}if(parent){$itemInstance[0].dataset.level=parent.data("level")+1;$itemInstance.data("parent",parent)}else{$itemInstance[0].dataset.level=0}if(item.menu){$itemInstance.addClass("parentMenu");$itemInstance.data("menu",item.menu)}$itemInstance.on("mouseenter",function(e){if(item.menu){renderPopUpMenu($itemInstance.data("menu"),$itemInstance)}else{that.trigger("createMenu",$itemInstance[0].dataset.level)}if(!$itemInstance.data("isTitle")){$itemInstance.addClass("hover")}that.$el.find(".item").removeClass("active");var tmp=parent;while(tmp){tmp.addClass("active");tmp=tmp.data("parent")}}).on("mouseleave",function(e){$itemInstance.removeClass("hover")}).on("click",function(e){if(item.handler){item.handler()}})}});if(parent){var parentOffset=parent.offset();if(parentOffset.left+parent.outerWidth()+$menuInstance.outerWidth()<=$(window).width()){$menuInstance.css("left",parentOffset.left+parent.outerWidth())}else{$menuInstance.css("left",parentOffset.left-$menuInstance.outerWidth())}if(parentOffset.top+$menuInstance.outerHeight()+parseInt($menuInstance.css("marginTop"))<=$(window).height()){$menuInstance.css("top",parentOffset.top-1)}else{$menuInstance.css("bottom",0);if($menuInstance.outerHeight()>$(window).height()){$menuInstance.css({top:0,bottom:"","margin-top":0});$menuInstance.css("height",$(window).height()).jScrollPane({autoReinitialise:true})}}}else{if(that.mouseX+$menuInstance.outerWidth()<=$(window).width()){$menuInstance.css("left",that.mouseX)}else{$menuInstance.css("left",that.mouseX-$menuInstance.outerWidth())}if(that.mouseY+$menuInstance.outerHeight()<=$(window).height()){$menuInstance.css("top",that.mouseY)}else{$menuInstance.css("bottom",0);if($menuInstance.outerHeight()>$(window).height()){$menuInstance.css({top:0,bottom:"","margin-top":0});$menuInstance.css("height",$(window).height()).jScrollPane({autoReinitialise:true})}}}}this.on("createMenu",function(e,level){if(that.$el){var allMenu=that.$el.find(".menu");allMenu.each(function(index,menu){if($(menu).data("level")>level){$(menu).remove()}})}})};$.fn.RSdropdown=function(menu){var that=this;if(!menu){menu={data:[]}}if(!menu.options){menu.options={}}$(that).hide();if($(that)[0].tagName==="SELECT"){$(that).find("option").each(function(key,option){menu.data.push({text:$(option).text(),val:$(option).val()})})}that.$dropdownHead=$('<div class="RSdropdownHead">').html(menu.data[0].text).attr("value",menu.data[0].val);if(menu.options.width){that.$dropdownHead.css("width",menu.options.width)}$(that).after(that.$dropdownHead);that.$dropdownHead.on("click",function(){if(menu.options.onShow){menu.options.onShow()}that.$el=$('<div id="RSdropdown">').appendTo("body");that.$dropdownHead.addClass("active");if(menu.options.debug){that.$el.addClass("debug")}that.$el.on("click contextmenu",function(e){e.preventDefault();that.$el.remove();that.$dropdownHead.removeClass("active");if(menu.options.onClose){menu.options.onClose()}});renderDropdown(menu)});function renderDropdown(menu,parent){that.trigger("createMenu",parent&&parent.data("level")||0);var $menuInstance=$('<div class="menu">').appendTo(that.$el);if(parent){$menuInstance[0].dataset.level=parent.data("level")+1;$menuInstance.data("parent",parent);$menuInstance.addClass("submenu")}else{$menuInstance[0].dataset.level=0}menu.data.forEach(function(item){if(typeof item.hide==="function"){if(item.hide())return}else if(typeof item.hide==="boolean"){if(item.hide)return}if(item.divider){var $itemInstance=$('<div class="divider">').appendTo($menuInstance)}else{var $itemInstance=$('<div class="item">').html(item.text).appendTo($menuInstance);if(item.class){$itemInstance.addClass(item.class)}if(item.isTitle){$itemInstance.data("isTitle",true);$itemInstance.addClass("isTitle")}if(parent){$itemInstance[0].dataset.level=parent.data("level")+1;$itemInstance.data("parent",parent)}else{$itemInstance[0].dataset.level=0}if(item.menu){$itemInstance.addClass("parentMenu");$itemInstance.data("menu",item.menu)}if(that.$dropdownHead.attr("value")===item.val){$itemInstance.addClass("selected")}else if(item.menu){var searchArray=[item];while(searchArray.length){search(searchArray[0],that.$dropdownHead.attr("value"));searchArray.shift()}function search(item,val){if(item.menu){$.each(item.menu.data,function(key,item){searchArray.push(item)})}else{if(item.val===val){$itemInstance.addClass("parentOfSelected")}}}}$itemInstance.on("mouseenter",function(e){if(item.menu){renderDropdown($itemInstance.data("menu"),$itemInstance)}else{that.trigger("createMenu",$itemInstance[0].dataset.level)}if(!$itemInstance.data("isTitle")){$itemInstance.addClass("hover")}that.$el.find(".item").removeClass("active");var tmp=parent;while(tmp){tmp.addClass("active");tmp=tmp.data("parent")}}).on("mouseleave",function(e){$itemInstance.removeClass("hover")}).on("click",function(e){if(!item.isTitle&&!item.menu){$(that).trigger("change",item.val);that.$dropdownHead.html(item.text).attr("value",item.val)}if(item.handler){item.handler()}})}});if(parent){var parentOffset=parent.offset();if(parentOffset.left+parent.outerWidth()+$menuInstance.outerWidth()<=$(window).width()){$menuInstance.css("left",parentOffset.left+parent.outerWidth())}else{$menuInstance.css("left",parentOffset.left-$menuInstance.outerWidth())}if(parentOffset.top+$menuInstance.outerHeight()+parseInt($menuInstance.css("marginTop"))<=$(window).height()){$menuInstance.css("top",parentOffset.top-1)}else{$menuInstance.css("bottom",0);if($menuInstance.outerHeight()>$(window).height()){$menuInstance.css({top:0,bottom:"","margin-top":0});$menuInstance.css("height",$(window).height()).jScrollPane({autoReinitialise:true})}}}else{var offset=that.$dropdownHead.offset();$menuInstance.css("left",offset.left);$menuInstance.css("width",that.$dropdownHead.outerWidth());if(offset.top+that.$dropdownHead.outerHeight()+$menuInstance.outerHeight()<=$(window).height()){$menuInstance.css("top",offset.top+that.$dropdownHead.outerHeight())}else{if(offset.top>$(window).height()-offset.top){$menuInstance.css("top",offset.top-$menuInstance.outerHeight());if($menuInstance.outerHeight()>offset.top){$menuInstance.css("height",offset.top).jScrollPane({autoReinitialise:true})}}else{$menuInstance.css("top",offset.top+that.$dropdownHead.outerHeight());if($menuInstance.outerHeight()+offset.top>$(window).height()){$menuInstance.css("height",$(window).height()-(offset.top+that.$dropdownHead.outerHeight())).jScrollPane({autoReinitialise:true})}}}}}this.on("createMenu",function(e,level){if(that.$el){var allMenu=that.$el.find(".menu");allMenu.each(function(index,menu){if($(menu).data("level")>level){$(menu).remove()}})}});return this}})(jQuery);